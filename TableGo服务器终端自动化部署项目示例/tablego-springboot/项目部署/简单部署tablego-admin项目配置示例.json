{
  "isOpenTerminal" : true,
  "isOutLogToTerminal" : true,
  "isOutLogToFile" : false,
  "projectPath" : "G:\\tablego-springboot",
  "scriptPath" : "G:\\tablego-springboot\\项目部署",
  "serverProjectPath" : "/opt/tablego-springboot",
  "profiles" : {
    "dev" : {
      "profile" : "dev",
      "port" : "8080",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : false,
      "deploy" : true,
      "cleanProject" : true
    },
    "test" : {
      "profile" : "test",
      "port" : "8081",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : false,
      "deploy" : true,
      "cleanProject" : true
    },
    "prod" : {
      "profile" : "prod",
      "port" : "8082",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : true,
      "deploy" : true,
      "cleanProject" : true
    }
  },
  "batchConfig" : [ {
    "enable" : "${updateAndPackage}",
    "remark" : "更新SVN代码并打包",
    "mutexLock" : "package",
    "runtimeExec" : [ {
      "command" : "${scriptPath}\\svn-update-project.bat ${projectPath}",
      "enable" : false
    }, {
      "command" : "${scriptPath}\\maven-lifecycle.bat \"clean package\" ${projectPath}\\tablego-admin",
      "enable" : true
    } ]
  }, {
    "enable" : "${uploadShell}",
    "remark" : "上传脚本文件，并替换脚本的换行符并给脚本授权",
    "fileUploads" : [ {
      "fromPath" : [ "${scriptPath}\\AppService.sh", "${scriptPath}\\ClearBakFile.sh" ],
      "toPath" : "${serverProjectPath}",
      "enable" : true
    } ],
    "commands" : [ {
      "command" : "cd ${serverProjectPath}"
    }, {
      "command" : "sed -i 's/\\r$//' AppService.sh ClearBakFile.sh",
      "enable" : true
    }, {
      "command" : "sudo chmod +x AppService.sh ClearBakFile.sh",
      "enable" : true
    } ]
  }, {
    "enable" : "${backup}",
    "remark" : "备份 tablego-admin 工程",
    "commands" : [ {
      "command" : "cd ${serverProjectPath}"
    }, {
      "command" : "mkdir -p ${serverProjectPath}/bak/tablego-admin",
      "enable" : true
    }, {
      "command" : "cp -vf tablego-admin.jar ./bak/tablego-admin/tablego-admin_`date +%Y%m%d%H%M%S`.jar",
      "containsStr" : ".jar",
      "enable" : true
    }, {
      "command" : "sh ClearBakFile.sh -d ${serverProjectPath}/bak/tablego-admin -e jar",
      "waitSeconds" : 2,
      "enable" : true
    } ]
  }, {
    "enable" : "${deploy}",
    "remark" : "部署 tablego-admin 工程",
    "fileUploads" : [ {
      "fromPath" : [ "${projectPath}\\tablego-admin\\target\\tablego-admin.jar" ],
      "toPath" : "${serverProjectPath}",
      "enable" : true
    } ],
    "commands" : [ {
      "command" : "sh AppService.sh restart tablego-admin ${profile} ${port}"
    }, {
      "command" : "touch tablego-admin.log && tail -f tablego-admin.log",
      "containsStrSigquit" : "Started AdminApplication"
    } ]
  }, {
    "enable" : "${cleanProject}",
    "remark" : "清理项目",
    "mutexLock" : "cleanProject",
    "runtimeExec" : [ {
      "command" : "${scriptPath}\\maven-lifecycle.bat clean ${projectPath}\\tablego-admin",
      "enable" : true
    } ]
  }, {
    "fileDownloads" : [ {
      "fromPath" : "${serverProjectPath}",
      "toPath" : "${projectPath}",
      "files" : [ "AppService.sh", "ClearBakFile.sh" ],
      "enable" : false
    } ]
  } ]
}