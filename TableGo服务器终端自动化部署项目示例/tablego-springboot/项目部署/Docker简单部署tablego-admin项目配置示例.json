{
  "isOpenTerminal" : true,
  "isOutLogToTerminal" : true,
  "isOutLogToFile" : false,
  "projectPath" : "G:\\tablego-springboot",
  "scriptPath" : "G:\\tablego-springboot\\项目部署",
  "serverProjectPath" : "/opt/tablego-springboot",
  "profiles" : {
    "dev" : {
      "profile" : "dev",
      "port" : "8080",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : false,
      "deploy" : true,
      "cleanProject" : true
    },
    "test" : {
      "profile" : "test",
      "port" : "8081",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : false,
      "deploy" : true,
      "cleanProject" : true
    },
    "prod" : {
      "profile" : "prod",
      "port" : "8082",
      "updateAndPackage" : true,
      "uploadShell" : true,
      "backup" : true,
      "deploy" : true,
      "cleanProject" : true
    }
  },
  "batchConfig" : [ {
    "enable" : "${updateAndPackage}",
    "remark" : "更新Git代码并打包",
    "mutexLock" : "package",
    "runtimeExec" : [ {
      "command" : "${scriptPath}\\git-update-project.bat ${projectPath}",
      "enable" : false
    }, {
      "command" : "${scriptPath}\\maven-lifecycle.bat \"clean package\" ${projectPath}\\tablego-admin",
      "enable" : true
    } ]
  }, {
    "enable" : "${uploadShell}",
    "remark" : "上传工程包和脚本文件",
    "fileUploads" : [ {
      "fromPath" : [ "${projectPath}\\tablego-admin\\target\\tablego-admin.jar", "${projectPath}\\tablego-admin\\Dockerfile" ],
      "toPath" : "${serverProjectPath}/tablego-admin",
      "enable" : true
    }, {
      "fromPath" : [ "${scriptPath}\\ClearDockerBakImage.sh" ],
      "toPath" : "${serverProjectPath}",
      "enable" : true
    } ]
  }, {
    "enable" : "${uploadShell}",
    "remark" : "替换脚本的换行符并给脚本授权",
    "commands" : [ {
      "command" : "cd ${serverProjectPath}"
    }, {
      "command" : "sed -i 's/\\r$//' ClearDockerBakImage.sh",
      "enable" : true
    }, {
      "command" : "sudo chmod +x ClearDockerBakImage.sh",
      "enable" : true
    } ]
  }, {
    "enable" : "${backup}",
    "remark" : "备份 tablego-admin 工程",
    "commands" : [ {
      "command" : "cd ${serverProjectPath}"
    }, {
      "command" : "docker tag tablego-admin tablego-admin_`date +%Y%m%d%H%M%S`",
      "sleepSeconds" : 2,
      "enable" : true
    }, {
      "command" : "sh ClearDockerBakImage.sh -p tablego-admin_",
      "waitSeconds" : 2,
      "enable" : true
    } ]
  }, {
    "enable" : "${deploy}",
    "remark" : "部署 tablego-admin 工程",
    "commands" : [ {
      "command" : "cd ${serverProjectPath}/tablego-admin"
    }, {
      "command" : "docker rm -f tablego-admin",
      "containsStr" : "tablego-admin",
      "enable" : true
    }, {
      "command" : "docker build -t tablego-admin .",
      "containsStr" : "Successfully tagged",
      "enable" : true
    }, {
      "command" : "docker run -dp ${port}:8080 --name=tablego-admin tablego-admin --spring.profiles.active=${profile}",
      "sleepSeconds" : 3,
      "enable" : true
    }, {
      "command" : "docker logs -f tablego-admin",
      "containsStrSigquit" : "Started AdminApplication",
      "enable" : true
    }, {
      "command" : "docker image prune -f",
      "containsStr" : "Total reclaimed space"
    } ]
  }, {
    "enable" : "${cleanProject}",
    "remark" : "清理项目",
    "mutexLock" : "cleanProject",
    "runtimeExec" : [ {
      "command" : "${scriptPath}\\maven-lifecycle.bat clean ${projectPath}\\tablego-admin",
      "enable" : true
    } ]
  }, {
    "enable" : true,
    "remark" : "清理Docker虚悬镜像",
    "commands" : [ {
      "command" : "docker image prune -f",
      "containsStr" : "Total reclaimed space"
    }, {
      "command" : "docker ps"
    } ]
  } ]
}